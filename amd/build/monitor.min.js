define("quizaccess_announcements/monitor",["exports","./repository","core/str"],(function(_exports,_repository,_str){
/**
   * Check student status for the quizaccess_announcements plugin.
   *
   * @module     quizaccess_announcements/monitor
   * @copyright  Jeffrey Black
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
var quizid,studentinterval,delay,hcont,tcont,ecnt;function clearclasses(row){row.classList.remove("table-success"),row.classList.remove("table-warning"),row.classList.remove("table-danger")}async function fetchstatus(){var getstatusp=(0,_repository.getstatus)(quizid).then((statret=>{ecnt=0,hcont.innerHTML=statret.last.str;var ntbody=document.createElement("tbody");statret.status.forEach(function(ntbody,last){return function(student){let row=tcont.querySelector("tr.u_"+student.userid);if(row){try{clearclasses(row),row.querySelector("td.cell.time").innerHTML=student.str,row.querySelector("td.cell.ago").innerHTML=student.ago,student.ago>2*studentinterval?row.classList.add("table-danger"):student.ago>studentinterval||null!==last&&last>student.time?row.classList.add("table-warning"):row.classList.add("table-success")}catch(e){window.console.error("Error updating student status",e),ecnt=10}ntbody.appendChild(row)}else window.console.log("Unable to find row for student "+student.userid)}}(ntbody,statret.last.time));for(var row=tcont.rows[0];row;)clearclasses(row),row.querySelector("td.cell.time").innerHTML="-",row.querySelector("td.cell.ago").innerHTML="-",ntbody.appendChild(row),row=tcont.rows[0];return tcont.replaceWith(ntbody),tcont=ntbody,statret})).catch((err=>(window.console.error("Error in AJAX request",err),ecnt++,err)));await getstatusp,ecnt<5?window.setTimeout(fetchstatus,delay):(0,_str.get_string)("monitor_ajax_error","quizaccess_announcements").then((str=>(hcont.innerHTML=str,str))).catch((err=>{window.console.error("Error getting string",err),hcont.innerHTML="Error fetching student status. Additionally, error fetching error string."}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(qid,checkinterval,interval,lastid,contid){if(quizid=qid,studentinterval=parseInt(checkinterval),delay=1e3*parseInt(interval),hcont=document.getElementById(lastid),tcont=document.getElementById(contid),ecnt=0,!(tcont&&(tcont=tcont.querySelector("tbody"))))return void window.console.error("Unable to find table body to update.",contid);window.setTimeout(fetchstatus,delay)}}));

//# sourceMappingURL=monitor.min.js.map